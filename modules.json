{
  "modules": {
    "system": {
      "name": "Mise √† jour syst√®me",
      "icon": "üîÑ",
      "script": "\n##############################################\necho \"=== üåÄ Mise √† jour du syst√®me ===\"\n##############################################\napt update && apt upgrade -y\napt install software-properties-common curl unzip git -y\n"
    },
    "apache": {
      "name": "Apache2",
      "icon": "üåê",
      "script": "\n##############################################\necho \"=== üåê Installation Apache2 ===\"\n##############################################\napt install apache2 -y\na2enmod rewrite headers\nsystemctl enable apache2\n"
    },
    "firewall": {
      "name": "Pare-feu (UFW)",
      "icon": "üî•",
      "script": "\n##############################################\necho \"=== üî• Configuration du Pare-feu (UFW) ===\"\n##############################################\napt install ufw -y\nufw allow OpenSSH\nufw allow 80/tcp\nufw allow 443/tcp\nufw --force enable\n"
    },
    "sftp": {
      "name": "SFTP",
      "icon": "üîê",
      "script": "\n##############################################\necho \"=== üßë Cr√©ation de l'utilisateur SFTP + groupe ===\"\n##############################################\ngroupadd \"{{SFTP_GROUP}}\" || true\n\nif ! id \"{{SFTP_USER}}\" &>/dev/null; then\n    adduser --gecos \"\" --no-create-home \"{{SFTP_USER}}\"\n    echo \"{{SFTP_USER}}:{{SFTP_PASS}}\" | chpasswd\n    usermod -aG \"{{SFTP_GROUP}}\" \"{{SFTP_USER}}\"\nfi\n\n##############################################\necho \"=== üìÅ Cr√©ation des r√©pertoires web ===\"\n##############################################\nmkdir -p {{PROJECT_ROOT}}/public\nchown root:root /var/www/{{SFTP_USER}}\nchmod 755 /var/www/{{SFTP_USER}}\nchown -R {{SFTP_USER}}:{{SFTP_GROUP}} /var/www/{{SFTP_USER}}/www\nchown -R {{SFTP_USER}}:www-data {{PROJECT_ROOT}}\n\n##############################################\necho \"=== üé® Cr√©ation de index.php avec style ===\"\n##############################################\ncat > {{PROJECT_ROOT}}/public/index.php <<'INDEXPHP'\n<!DOCTYPE html>\n<html lang=\"fr\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>COCO - √áa marche! üéâ</title>\n    <style>\n        body {\n            margin: 0;\n            padding: 0;\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n        .container {\n            text-align: center;\n            background: white;\n            padding: 50px 60px;\n            border-radius: 20px;\n            box-shadow: 0 20px 60px rgba(0,0,0,0.3);\n        }\n        h1 {\n            font-size: 3em;\n            color: #667eea;\n            margin: 0 0 20px 0;\n        }\n        .emoji {\n            font-size: 4em;\n            margin: 20px 0;\n        }\n        p {\n            font-size: 1.5em;\n            color: #333;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"emoji\">ü•• ‚ú® üöÄ</div>\n        <h1>COCO</h1>\n        <p>√ßa marche ! üéâ</p>\n        <div class=\"emoji\">üí™ üî• ‚úÖ</div>\n    </div>\n</body>\n</html>\nINDEXPHP\n\nchown {{SFTP_USER}}:www-data {{PROJECT_ROOT}}/public/index.php\nchmod 644 {{PROJECT_ROOT}}/public/index.php\n\n##############################################\necho \"=== üîë Activation de l'authentification par mot de passe SSH ===\"\n##############################################\nsed -i 's/^PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config\nsystemctl restart ssh\n\n##############################################\necho \"=== üîê Configuration du jail SFTP ===\"\n##############################################\nSSHD_CONFIG=\"/etc/ssh/sshd_config\"\n\nif ! grep -q \"Match Group {{SFTP_GROUP}}\" \"$SSHD_CONFIG\"; then\ncat <<EOF >> $SSHD_CONFIG\n\nSubsystem sftp internal-sftp\n\nMatch Group {{SFTP_GROUP}}\n    ChrootDirectory /var/www/%u\n    ForceCommand internal-sftp\n    X11Forwarding no\n    AllowTcpForwarding no\nEOF\nsystemctl restart ssh\nfi\n\n##############################################\necho \"=== üèó Configuration du VirtualHost Apache ===\"\n##############################################\ncat > /etc/apache2/sites-available/000-default.conf <<EOL\n<VirtualHost *:80>\n    DocumentRoot {{PROJECT_ROOT}}/public\n\n    <Directory {{PROJECT_ROOT}}/public>\n        Options +FollowSymLinks\n        AllowOverride All\n        Require all granted\n    </Directory>\n\n    ErrorLog \\${APACHE_LOG_DIR}/project_error.log\n    CustomLog \\${APACHE_LOG_DIR}/project_access.log combined\n</VirtualHost>\nEOL\n\napache2ctl configtest\nsystemctl reload apache2\n"
    },
    "php": {
      "name": "PHP 8.3",
      "icon": "üêò",
      "script": "\n##############################################\necho \"=== üõ† Installation de PHP 8.3 (Ubuntu Noble Officiel) ===\"\n##############################################\napt install -y php8.3 php8.3-cli php8.3-fpm \\\nphp8.3-common php8.3-mbstring php8.3-xml \\\nphp8.3-intl php8.3-curl php8.3-zip php8.3-gd \\\nphp8.3-bcmath php8.3-mysql php8.3-opcache \\\nlibapache2-mod-php8.3\n\nsystemctl restart apache2\n"
    },
    "composer": {
      "name": "Composer",
      "icon": "üì¶",
      "script": "\n##############################################\necho \"=== üì¶ Installation de Composer ===\"\n##############################################\ncurl -sS https://getcomposer.org/installer | php\nmv composer.phar /usr/local/bin/composer\nchmod +x /usr/local/bin/composer\n"
    },
    "mariadb": {
      "name": "MariaDB",
      "icon": "üíæ",
      "script": "\n##############################################\necho \"=== üíæ Installation de MariaDB ===\"\n##############################################\napt install mariadb-server mariadb-client -y\n\n##############################################\necho \"=== üõ° S√©curisation de MariaDB ===\"\n##############################################\nmysql -e \"DELETE FROM mysql.user WHERE User='';\"\nmysql -e \"DROP DATABASE IF EXISTS test;\"\nmysql -e \"FLUSH PRIVILEGES;\"\n\n##############################################\necho \"=== üé≤ Cr√©ation de la base de donn√©es + utilisateur ===\"\n##############################################\nmysql -e \"CREATE DATABASE IF NOT EXISTS {{MYSQL_DB}};\"\nmysql -e \"CREATE USER IF NOT EXISTS '{{MYSQL_USER}}'@'localhost' IDENTIFIED BY '{{MYSQL_PASS}}';\"\nmysql -e \"GRANT ALL PRIVILEGES ON {{MYSQL_DB}}.* TO '{{MYSQL_USER}}'@'localhost';\"\nmysql -e \"FLUSH PRIVILEGES;\"\n"
    },
    "phpmyadmin": {
      "name": "phpMyAdmin",
      "icon": "üß∞",
      "script": "\n##############################################\necho \"=== üß∞ Installation de phpMyAdmin ===\"\n##############################################\nDEBIAN_FRONTEND=noninteractive apt install phpmyadmin -y\nln -sf /etc/phpmyadmin/apache.conf /etc/apache2/conf-available/phpmyadmin.conf\na2enconf phpmyadmin\nsystemctl reload apache2\n"
    }
  }
}
